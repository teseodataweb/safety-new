<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Administrador de Productos - AP Safety</title>
    <!-- favicons Icons -->
    <link rel="apple-touch-icon" sizes="180x180" href="assets/images/favicons/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="assets/images/favicons/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="assets/images/favicons/favicon-16x16.png" />

    <!-- fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com/">
    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Archivo:ital,wght@0,100..900;1,100..900&amp;display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Titillium+Web:ital,wght@0,200;0,300;0,400;0,600;0,700;0,900;1,200;1,300;1,400;1,600;1,700&amp;display=swap" rel="stylesheet">

    <link rel="stylesheet" href="assets/css/bootstrap.min.css" />
    <link rel="stylesheet" href="assets/css/animate.min.css" />
    <link rel="stylesheet" href="assets/css/custom-animate.css" />
    <link rel="stylesheet" href="assets/css/swiper.min.css" />
    <link rel="stylesheet" href="assets/css/font-awesome-all.css" />
    <link rel="stylesheet" href="assets/css/jarallax.css" />
    <link rel="stylesheet" href="assets/css/jquery.magnific-popup.css" />
    <link rel="stylesheet" href="assets/css/flaticon.css">
    <link rel="stylesheet" href="assets/css/owl.carousel.min.css" />
    <link rel="stylesheet" href="assets/css/owl.theme.default.min.css" />
    <link rel="stylesheet" href="assets/css/nice-select.css" />
    <link rel="stylesheet" href="assets/css/jquery-ui.css" />
    <link rel="stylesheet" href="assets/css/aos.css" />
    <link rel="stylesheet" href="assets/css/odometer.min.css" />

    <link rel="stylesheet" href="assets/css/module-css/slider.css" />
    <link rel="stylesheet" href="assets/css/module-css/footer.css" />
    <link rel="stylesheet" href="assets/css/module-css/page-header.css" />

    <link rel="stylesheet" href="assets/css/style.css" />
    <link rel="stylesheet" href="assets/css/responsive.css" />
    <link rel="stylesheet" href="assets/css/ap-safety-custom.css" />

    <style>
        .admin-container {
            padding: 40px 0;
            min-height: 100vh;
            background: #f8f9fa;
        }

        .admin-header-card {
            background: white;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
        }

        .admin-header-card h1 {
            color: var(--ap-verde-corporativo);
            margin-bottom: 10px;
        }

        .admin-actions {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .admin-section {
            background: white;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
        }

        .form-section {
            margin-bottom: 25px;
        }

        .form-section h3 {
            color: var(--ap-verde-corporativo);
            font-size: 18px;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e0e0e0;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group label {
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
            display: block;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 5px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--ap-verde-corporativo);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .certification-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .cert-tag {
            padding: 5px 15px;
            background: #f0f0f0;
            border: 2px solid #e0e0e0;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .cert-tag:hover {
            border-color: var(--ap-verde-corporativo);
        }

        .cert-tag.selected {
            background: var(--ap-verde-corporativo);
            color: white;
            border-color: var(--ap-verde-corporativo);
        }

        .products-table {
            overflow-x: auto;
        }

        .products-table table {
            width: 100%;
            border-collapse: collapse;
        }

        .products-table th {
            background: var(--ap-verde-corporativo);
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: 600;
        }

        .products-table td {
            padding: 12px;
            border-bottom: 1px solid #e0e0e0;
        }

        .products-table tr:hover {
            background: #f8f9fa;
        }

        .action-buttons {
            display: flex;
            gap: 5px;
        }

        .btn-edit,
        .btn-delete {
            padding: 5px 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .btn-edit {
            background: #ffc107;
            color: white;
        }

        .btn-edit:hover {
            background: #ffb300;
        }

        .btn-delete {
            background: #dc3545;
            color: white;
        }

        .btn-delete:hover {
            background: #c82333;
        }

        .btn-primary {
            background: var(--ap-verde-corporativo);
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            background: var(--ap-verde-oscuro);
        }

        .btn-secondary {
            background: white;
            color: var(--ap-verde-corporativo);
            padding: 12px 30px;
            border: 2px solid var(--ap-verde-corporativo);
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .btn-secondary:hover {
            background: var(--ap-verde-corporativo);
            color: white;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .alert {
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-danger {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .stats-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .stat-card h4 {
            color: #666;
            font-size: 14px;
            margin-bottom: 10px;
        }

        .stat-card .stat-number {
            color: var(--ap-verde-corporativo);
            font-size: 32px;
            font-weight: bold;
        }

        .search-bar {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .search-bar input {
            flex: 1;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 5px;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 9999;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 10px;
            max-width: 500px;
            width: 90%;
        }

        .modal-header {
            margin-bottom: 20px;
        }

        .modal-header h3 {
            color: var(--ap-verde-corporativo);
            margin: 0;
        }

        .modal-footer {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }

            .stats-cards {
                grid-template-columns: 1fr;
            }

            .admin-actions {
                flex-direction: column;
            }
        }
    </style>
</head>

<body class="custom-cursor">

    <div class="custom-cursor__cursor"></div>
    <div class="custom-cursor__cursor-two"></div>

    <!--Start Preloader-->
    <div class="loader js-preloader">
        <div></div>
        <div></div>
        <div></div>
    </div>
    <!--End Preloader-->

    <!-- Header Start -->
    <header class="main-header">
        <div class="main-menu__top">
            <div class="main-menu__top-inner">
                <ul class="list-unstyled main-menu__contact-list">
                    <li>
                        <div class="icon">
                            <i class="icon-call"></i>
                        </div>
                        <div class="text">
                            <p><a href="tel:5255555555">+52 (55) 5555-5555</a></p>
                        </div>
                    </li>
                    <li>
                        <div class="icon">
                            <i class="icon-envelope"></i>
                        </div>
                        <div class="text">
                            <p><a href="mailto:ventas@apsafety.com.mx">ventas@apsafety.com.mx</a></p>
                        </div>
                    </li>
                    <li>
                        <div class="icon">
                            <i class="icon-location"></i>
                        </div>
                        <div class="text">
                            <p>Ciudad de México, México</p>
                        </div>
                    </li>
                </ul>
                <p class="main-menu__top-welcome-text">Panel de Administración - AP Safety</p>
                <div class="main-menu__top-right">
                    <div class="main-menu__top-time">
                        <div class="main-menu__top-time-icon">
                            <span class="icon-clock"></span>
                        </div>
                        <p class="main-menu__top-text">Lun - Vie: 08:00 - 18:00</p>
                    </div>
                </div>
            </div>
        </div>
        <nav class="main-menu">
            <div class="main-menu__wrapper">
                <div class="main-menu__wrapper-inner">
                    <div class="main-menu__left">
                        <div class="main-menu__logo">
                            <a href="index.html"><img src="assets/images/resources/logo-1.png" alt=""></a>
                        </div>
                    </div>
                    <div class="main-menu__main-menu-box">
                        <a href="#" class="mobile-nav__toggler"><i class="fa fa-bars"></i></a>
                        <ul class="main-menu__list">
                            <li>
                                <a href="index.html">Inicio</a>
                            </li>
                            <li>
                                <a href="products.html">Ver Catálogo</a>
                            </li>
                            <li class="current">
                                <a href="admin-products.html">Administrar Productos</a>
                            </li>
                            <li>
                                <a href="login.html" onclick="window.SimpleAuth.logout();">Cerrar Sesión</a>
                            </li>
                        </ul>
                    </div>
                    <div class="main-menu__right">
                        <div class="main-menu__call">
                            <div class="main-menu__call-icon">
                                <i class="icon-user"></i>
                            </div>
                            <div class="main-menu__call-content">
                                <p class="main-menu__call-sub-title">Sesión Admin</p>
                                <h5 class="main-menu__call-number" id="admin-user">Administrador</h5>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </nav>
    </header>

    <div class="stricky-header stricked-menu main-menu">
        <div class="sticky-header__content"></div>
    </div>

    <!--Page Header Start-->
    <section class="page-header">
        <div class="page-header__bg" style="background-image: url(assets/images/backgrounds/page-header-bg.jpg);">
        </div>
        <div class="page-header__shape-one">
            <img src="assets/images/shapes/page-header-shape-1.png" alt="">
        </div>
        <div class="page-header__shape-two">
            <img src="assets/images/shapes/page-header-shape-2.png" alt="">
        </div>
        <div class="page-header__shape-three">
            <img src="assets/images/shapes/page-header-shape-3.png" alt="">
        </div>
        <div class="container">
            <div class="page-header__inner">
                <h2>Administrador de Productos</h2>
                <div class="thm-breadcrumb__box">
                    <ul class="thm-breadcrumb">
                        <li><a href="index.html">Inicio</a></li>
                        <li><span class="icon-angle-left"></span></li>
                        <li><a href="products.html">Productos</a></li>
                        <li><span class="icon-angle-left"></span></li>
                        <li>Administrador</li>
                    </ul>
                </div>
            </div>
        </div>
    </section>
    <!--Page Header End-->

    <div class="admin-container">
        <div class="container">
            <!-- Mensajes de alerta -->
            <div id="alerts-container"></div>

            <!-- Estadísticas -->
            <div class="stats-cards">
                <div class="stat-card">
                    <h4>Total Productos</h4>
                    <div class="stat-number" id="total-products">0</div>
                </div>
                <div class="stat-card">
                    <h4>Mascarillas</h4>
                    <div class="stat-number" id="total-masks">0</div>
                </div>
                <div class="stat-card">
                    <h4>Con Certificación</h4>
                    <div class="stat-number" id="total-certified">0</div>
                </div>
                <div class="stat-card">
                    <h4>Con Ficha Técnica</h4>
                    <div class="stat-number" id="total-pdf">0</div>
                </div>
            </div>

            <!-- Acciones principales -->
            <div class="admin-actions">
                <button class="btn-primary" onclick="toggleProductForm()">
                    <i class="fa fa-plus"></i> Agregar Nuevo Producto
                </button>
                <button class="btn-primary" onclick="loadFromJSON()">
                    <i class="fa fa-sync"></i> Cargar desde JSON
                </button>
                <button class="btn-secondary" onclick="exportProducts()">
                    <i class="fa fa-download"></i> Exportar JSON
                </button>
                <button class="btn-secondary" onclick="importProducts()">
                    <i class="fa fa-upload"></i> Importar JSON
                </button>
                <a href="products.html" class="btn-secondary">
                    <i class="fa fa-eye"></i> Ver Catálogo Público
                </a>
                <button class="btn-danger" onclick="confirmResetProducts()">
                    <i class="fa fa-undo"></i> Resetear
                </button>
            </div>

            <!-- Formulario de producto -->
            <div class="admin-section" id="product-form-section" style="display: none;">
                <form id="product-form">
                    <input type="hidden" id="product-id" value="">

                    <div class="form-section">
                        <h3>Información Básica</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Nombre del Producto *</label>
                                <input type="text" id="product-name" required placeholder="Ej: M10">
                            </div>
                            <div class="form-group">
                                <label>Tipo de Producto *</label>
                                <input type="text" id="product-type" required placeholder="Ej: Mascarilla desechable">
                            </div>
                            <div class="form-group">
                                <label>Categoría *</label>
                                <select id="product-category" required>
                                    <option value="mascarilla-desechable">Mascarilla Desechable</option>
                                    <option value="respirador-infantil">Respirador Infantil</option>
                                    <option value="respirador-reutilizable">Respirador Reutilizable</option>
                                    <option value="filtros-cartuchos">Filtros y Cartuchos</option>
                                    <option value="proteccion-visual">Protección Visual</option>
                                    <option value="proteccion-auditiva">Protección Auditiva</option>
                                    <option value="guantes">Guantes</option>
                                    <option value="cascos">Cascos</option>
                                    <option value="calzado-seguridad">Calzado de Seguridad</option>
                                    <option value="ropa-proteccion">Ropa de Protección</option>
                                    <option value="proteccion-alturas">Protección para Alturas</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>Protección y Aplicaciones</h3>
                        <div class="form-row">
                            <div class="form-group" style="grid-column: span 2;">
                                <label>Nivel de Protección *</label>
                                <input type="text" id="product-protection" required placeholder="Ej: N95, P95, Partículas Tóxicas">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group" style="grid-column: span 2;">
                                <label>Aplicaciones</label>
                                <textarea id="product-applications" placeholder="Describe las aplicaciones y usos del producto..."></textarea>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group" style="grid-column: span 2;">
                                <label>Características</label>
                                <textarea id="product-features" placeholder="Describe las características técnicas del producto..."></textarea>
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>Certificaciones</h3>
                        <div class="certification-tags">
                            <span class="cert-tag" data-cert="N95">N95</span>
                            <span class="cert-tag" data-cert="N99">N99</span>
                            <span class="cert-tag" data-cert="N100">N100</span>
                            <span class="cert-tag" data-cert="P95">P95</span>
                            <span class="cert-tag" data-cert="P100">P100</span>
                            <span class="cert-tag" data-cert="R95">R95</span>
                            <span class="cert-tag" data-cert="NIOSH">NIOSH</span>
                            <span class="cert-tag" data-cert="NOM-116-STPS-2009">NOM-116-STPS-2009</span>
                            <span class="cert-tag" data-cert="NMX-S-054-SCFI-2013">NMX-S-054-SCFI-2013</span>
                            <span class="cert-tag" data-cert="ANSI Z87.1">ANSI Z87.1</span>
                            <span class="cert-tag" data-cert="ISO">ISO</span>
                            <span class="cert-tag" data-cert="CE">CE</span>
                        </div>
                        <div class="form-group" style="margin-top: 15px;">
                            <label>Otras certificaciones (separadas por comas)</label>
                            <input type="text" id="other-certifications" placeholder="Ej: ISO 9001, CE">
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>Recursos</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label>URL del Video</label>
                                <input type="url" id="product-video" placeholder="https://youtube.com/...">
                            </div>
                            <div class="form-group">
                                <label>URL de Ficha Técnica (PDF)</label>
                                <input type="url" id="product-pdf" placeholder="http://ejemplo.com/ficha.pdf">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Ruta de Imagen</label>
                                <input type="text" id="product-image" placeholder="assets/images/products/producto.jpg">
                            </div>
                        </div>
                    </div>

                    <div style="display: flex; gap: 10px; justify-content: flex-end;">
                        <button type="button" class="btn-secondary" onclick="cancelProductForm()">Cancelar</button>
                        <button type="submit" class="btn-primary">
                            <i class="fa fa-save"></i> Guardar Producto
                        </button>
                    </div>
                </form>
            </div>

            <!-- Lista de productos -->
            <div class="admin-section">
                <h3 style="color: var(--ap-verde-corporativo); margin-bottom: 20px;">Lista de Productos</h3>

                <!-- Barra de búsqueda -->
                <div class="search-bar">
                    <input type="text" id="search-products" placeholder="Buscar productos...">
                    <button class="btn-primary" onclick="searchProductsList()">
                        <i class="fa fa-search"></i> Buscar
                    </button>
                </div>

                <!-- Tabla de productos -->
                <div class="products-table">
                    <table id="products-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Nombre</th>
                                <th>Tipo</th>
                                <th>Protección</th>
                                <th>Certificaciones</th>
                                <th>PDF</th>
                                <th>Video</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="products-tbody">
                            <!-- Los productos se cargarán aquí -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Input oculto para importar archivos -->
            <input type="file" id="import-file" accept=".json" style="display: none;">
        </div>
    </div>

    <!-- Modal de confirmación -->
    <div class="modal" id="confirm-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title">Confirmar Acción</h3>
            </div>
            <div class="modal-body">
                <p id="modal-message"></p>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeModal()">Cancelar</button>
                <button class="btn-danger" id="modal-confirm-btn">Confirmar</button>
            </div>
        </div>
    </div>

    <!--Site Footer Start-->
    <footer class="site-footer">
        <div class="site-footer__bg-color">
            <div class="footer-widget__shape-1">
                <img src="assets/images/shapes/footer-widget-shape-1.png" alt="">
            </div>
        </div>
        <div class="container">
            <div class="site-footer__top">
                <div class="row">
                    <div class="col-xl-3 col-lg-6 col-md-6 wow fadeInUp" data-wow-delay="100ms">
                        <div class="footer-widget__column footer-widget__about">
                            <div class="footer-widget__logo">
                                <a href="index.html"><img src="assets/images/resources/footer-logo.png" alt=""></a>
                            </div>
                            <p class="footer-widget__about-text">AP Safety - Fabricante líder de Equipos de Protección Personal certificados en México y LATAM.</p>
                        </div>
                    </div>
                    <div class="col-xl-2 col-lg-6 col-md-6 wow fadeInUp" data-wow-delay="200ms">
                        <div class="footer-widget__column footer-widget__usefull-link">
                            <div class="footer-widget__title-box">
                                <h3 class="footer-widget__title">Enlaces Rápidos</h3>
                            </div>
                            <div class="footer-widget__link-box">
                                <ul class="footer-widget__link list-unstyled">
                                    <li><a href="index.html">Inicio</a></li>
                                    <li><a href="products.html">Catálogo</a></li>
                                    <li><a href="admin-products.html">Panel Admin</a></li>
                                    <li><a href="contact.html">Contacto</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-3 col-lg-6 col-md-6 wow fadeInUp" data-wow-delay="300ms">
                        <div class="footer-widget__column footer-widget__services">
                            <div class="footer-widget__title-box">
                                <h3 class="footer-widget__title">Administración</h3>
                            </div>
                            <ul class="footer-widget__link list-unstyled">
                                <li><a href="#" onclick="toggleProductForm()">Agregar Producto</a></li>
                                <li><a href="#" onclick="exportProducts()">Exportar Base de Datos</a></li>
                                <li><a href="products.html">Ver Catálogo Público</a></li>
                                <li><a href="login.html" onclick="window.SimpleAuth.logout();">Cerrar Sesión</a></li>
                            </ul>
                        </div>
                    </div>
                    <div class="col-xl-4 col-lg-6 col-md-6 wow fadeInUp" data-wow-delay="400ms">
                        <div class="footer-widget__contact-box">
                            <div class="footer-widget__title-box">
                                <h3 class="footer-widget__title">Soporte Técnico</h3>
                            </div>
                            <ul class="footer-widget__contact list-unstyled">
                                <li>
                                    <div class="icon">
                                        <span class="icon-phone-call"></span>
                                    </div>
                                    <div class="content">
                                        <p><a href="tel:5255555555">+52 (55) 5555-5555</a></p>
                                    </div>
                                </li>
                                <li>
                                    <div class="icon">
                                        <span class="icon-envelope"></span>
                                    </div>
                                    <div class="content">
                                        <p><a href="mailto:soporte@apsafety.com.mx">soporte@apsafety.com.mx</a></p>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="site-footer__bottom">
            <div class="container">
                <div class="site-footer__bottom-inner">
                    <p class="site-footer__bottom-text">© 2025 <a href="#">AP Safety</a>. Panel de Administración - Todos los derechos reservados</p>
                </div>
            </div>
        </div>
    </footer>
    <!--Site Footer End-->

    <a href="#" data-target="html" class="scroll-to-target scroll-to-top">
        <span class="scroll-to-top__wrapper"><span class="scroll-to-top__inner"></span></span>
        <span class="scroll-to-top__text"> Ir arriba</span>
    </a>

    <!-- Scripts -->
    <script src="assets/js/jquery-latest.js"></script>
    <script src="assets/js/bootstrap.bundle.min.js"></script>
    <script src="assets/js/jarallax.min.js"></script>
    <script src="assets/js/jquery.ajaxchimp.min.js"></script>
    <script src="assets/js/jquery.appear.min.js"></script>
    <script src="assets/js/swiper.min.js"></script>
    <script src="assets/js/jquery.magnific-popup.min.js"></script>
    <script src="assets/js/jquery.validate.min.js"></script>
    <script src="assets/js/wNumb.min.js"></script>
    <script src="assets/js/wow.js"></script>
    <script src="assets/js/isotope.js"></script>
    <script src="assets/js/owl.carousel.min.js"></script>
    <script src="assets/js/jquery-ui.js"></script>
    <script src="assets/js/jquery.nice-select.min.js"></script>
    <script src="assets/js/marquee.min.js"></script>
    <script src="assets/js/countdown.min.js"></script>
    <script src="assets/js/jquery.circleType.js"></script>
    <script src="assets/js/jquery.fittext.js"></script>
    <script src="assets/js/jquery.lettering.min.js"></script>
    <script src="assets/js/jquery-sidebar-content.js"></script>
    <script src="assets/js/aos.js"></script>
    <script src="assets/js/odometer.min.js"></script>
    <script src="assets/js/gsap/gsap.js"></script>
    <script src="assets/js/gsap/ScrollTrigger.js"></script>
    <script src="assets/js/gsap/SplitText.js"></script>
    <script src="assets/js/script.js"></script>

    <!-- Scripts específicos del admin -->
    <script src="assets/js/auth-simple.js"></script>
    <script src="assets/js/products-loader.js"></script>

    <script>
        // Verificar autenticación
        if (!window.SimpleAuth.isAuthenticated()) {
            alert('Debe iniciar sesión para acceder a esta página');
            window.location.href = 'login.html';
        }

        // Variables globales
        let allProducts = [];
        let editingProductId = null;

        // Inicializar al cargar la página
        document.addEventListener('DOMContentLoaded', async function() {
            // Mostrar información de sesión
            const session = window.SimpleAuth.getSession();
            if (session) {
                document.getElementById('admin-user').textContent = session.user;
                const alertsContainer = document.getElementById('alerts-container');
                const timeRemaining = Math.ceil((session.expires - Date.now()) / 60000);
                alertsContainer.innerHTML = `
                    <div class="alert alert-success">
                        <i class="fa fa-user-shield"></i> Usuario: <strong>${session.user}</strong> |
                        Sesión expira en: <strong>${timeRemaining} minutos</strong>
                    </div>
                `;
            }

            // Cargar productos desde JSON
            await loadFromJSON();
            setupCertificationTags();
            setupFormSubmit();
            setupImportFile();
        });

        // Cargar productos desde el archivo JSON
        async function loadFromJSON() {
            try {
                const response = await fetch('productos_ap_safety.json');
                const rawProducts = await response.json();

                // Procesar productos con el loader
                allProducts = rawProducts.map(p => window.APSafetyProducts.processProductData(p));

                // Guardar en localStorage
                localStorage.setItem('apSafetyProductsDB', JSON.stringify(allProducts));

                loadProductsList();
                updateStats();
                showAlert(`Se cargaron ${allProducts.length} productos desde el archivo JSON`, 'success');
            } catch (error) {
                console.error('Error cargando productos:', error);
                // Intentar cargar desde localStorage
                const stored = localStorage.getItem('apSafetyProductsDB');
                if (stored) {
                    allProducts = JSON.parse(stored);
                    loadProductsList();
                    updateStats();
                } else {
                    showAlert('Error al cargar productos. Usando base de datos vacía.', 'danger');
                    allProducts = [];
                }
            }
        }

        // Configurar tags de certificación
        function setupCertificationTags() {
            document.querySelectorAll('.cert-tag').forEach(tag => {
                tag.addEventListener('click', function() {
                    this.classList.toggle('selected');
                });
            });
        }

        // Configurar envío de formulario
        function setupFormSubmit() {
            document.getElementById('product-form').addEventListener('submit', function(e) {
                e.preventDefault();
                saveProduct();
            });
        }

        // Mostrar/Ocultar formulario
        function toggleProductForm() {
            const formSection = document.getElementById('product-form-section');
            formSection.style.display = formSection.style.display === 'none' ? 'block' : 'none';

            if (formSection.style.display === 'block') {
                resetProductForm();
                window.scrollTo(0, formSection.offsetTop - 100);
            }
        }

        // Guardar producto
        function saveProduct() {
            const selectedCerts = [];
            document.querySelectorAll('.cert-tag.selected').forEach(tag => {
                selectedCerts.push(tag.dataset.cert);
            });

            const otherCerts = document.getElementById('other-certifications').value;
            if (otherCerts) {
                otherCerts.split(',').forEach(cert => {
                    const trimmed = cert.trim();
                    if (trimmed) selectedCerts.push(trimmed);
                });
            }

            const productData = {
                name: document.getElementById('product-name').value,
                type: document.getElementById('product-type').value,
                category: document.getElementById('product-category').value,
                protection: document.getElementById('product-protection').value,
                applications: document.getElementById('product-applications').value,
                features: document.getElementById('product-features').value,
                videoUrl: document.getElementById('product-video').value,
                pdfUrl: document.getElementById('product-pdf').value,
                image: document.getElementById('product-image').value || 'assets/images/products/default.jpg',
                certification: selectedCerts
            };

            if (editingProductId) {
                // Actualizar producto existente
                const index = allProducts.findIndex(p => p.id === editingProductId);
                if (index !== -1) {
                    productData.id = editingProductId;
                    allProducts[index] = productData;
                    showAlert('Producto actualizado exitosamente', 'success');
                }
            } else {
                // Agregar nuevo producto
                productData.id = 'product_' + Date.now();
                allProducts.push(productData);
                showAlert('Producto agregado exitosamente', 'success');
            }

            // Guardar en localStorage
            localStorage.setItem('apSafetyProductsDB', JSON.stringify(allProducts));

            resetProductForm();
            toggleProductForm();
            loadProductsList();
            updateStats();
        }

        // Resetear formulario
        function resetProductForm() {
            document.getElementById('product-form').reset();
            document.querySelectorAll('.cert-tag.selected').forEach(tag => {
                tag.classList.remove('selected');
            });
            editingProductId = null;
            document.getElementById('product-id').value = '';
        }

        // Cancelar formulario
        function cancelProductForm() {
            resetProductForm();
            toggleProductForm();
        }

        // Cargar lista de productos
        function loadProductsList() {
            const tbody = document.getElementById('products-tbody');

            if (allProducts.length === 0) {
                tbody.innerHTML = '<tr><td colspan="8" style="text-align: center;">No hay productos registrados</td></tr>';
                return;
            }

            tbody.innerHTML = allProducts.map(product => `
                <tr>
                    <td>${product.id}</td>
                    <td><strong>${product.name}</strong></td>
                    <td>${product.type || ''}</td>
                    <td>${product.protection || ''}</td>
                    <td>${product.certification ? product.certification.join(', ') : ''}</td>
                    <td>${product.pdfUrl ? '<i class="fa fa-check" style="color: green;"></i>' : '<i class="fa fa-times" style="color: red;"></i>'}</td>
                    <td>${product.videoUrl ? '<i class="fa fa-check" style="color: green;"></i>' : '<i class="fa fa-times" style="color: red;"></i>'}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn-edit" onclick="editProduct('${product.id}')">
                                <i class="fa fa-edit"></i>
                            </button>
                            <button class="btn-delete" onclick="confirmDeleteProduct('${product.id}')">
                                <i class="fa fa-trash"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        // Editar producto
        function editProduct(productId) {
            const product = allProducts.find(p => p.id === productId);
            if (!product) return;

            editingProductId = productId;

            // Llenar el formulario
            document.getElementById('product-id').value = product.id;
            document.getElementById('product-name').value = product.name;
            document.getElementById('product-type').value = product.type || '';
            document.getElementById('product-category').value = product.category;
            document.getElementById('product-protection').value = product.protection || '';
            document.getElementById('product-applications').value = product.applications || '';
            document.getElementById('product-features').value = product.features || '';
            document.getElementById('product-video').value = product.videoUrl || '';
            document.getElementById('product-pdf').value = product.pdfUrl || '';
            document.getElementById('product-image').value = product.image || '';

            // Marcar certificaciones
            document.querySelectorAll('.cert-tag').forEach(tag => {
                if (product.certification && product.certification.includes(tag.dataset.cert)) {
                    tag.classList.add('selected');
                } else {
                    tag.classList.remove('selected');
                }
            });

            // Mostrar formulario
            document.getElementById('product-form-section').style.display = 'block';
            window.scrollTo(0, document.getElementById('product-form-section').offsetTop - 100);
        }

        // Confirmar eliminación
        function confirmDeleteProduct(productId) {
            const product = allProducts.find(p => p.id === productId);
            if (!product) return;

            document.getElementById('modal-title').textContent = 'Confirmar Eliminación';
            document.getElementById('modal-message').textContent = `¿Estás seguro de que deseas eliminar el producto "${product.name}"?`;

            const confirmBtn = document.getElementById('modal-confirm-btn');
            confirmBtn.onclick = function() {
                deleteProduct(productId);
            };

            document.getElementById('confirm-modal').classList.add('active');
        }

        // Eliminar producto
        function deleteProduct(productId) {
            allProducts = allProducts.filter(p => p.id !== productId);
            localStorage.setItem('apSafetyProductsDB', JSON.stringify(allProducts));
            loadProductsList();
            updateStats();
            showAlert('Producto eliminado exitosamente', 'success');
            closeModal();
        }

        // Cerrar modal
        function closeModal() {
            document.getElementById('confirm-modal').classList.remove('active');
        }

        // Buscar productos
        function searchProductsList() {
            const searchTerm = document.getElementById('search-products').value.toLowerCase();

            if (!searchTerm) {
                loadProductsList();
                return;
            }

            const filtered = allProducts.filter(product => {
                return product.name.toLowerCase().includes(searchTerm) ||
                       (product.type && product.type.toLowerCase().includes(searchTerm)) ||
                       (product.protection && product.protection.toLowerCase().includes(searchTerm));
            });

            const tbody = document.getElementById('products-tbody');
            if (filtered.length === 0) {
                tbody.innerHTML = '<tr><td colspan="8" style="text-align: center;">No se encontraron productos</td></tr>';
                return;
            }

            tbody.innerHTML = filtered.map(product => `
                <tr>
                    <td>${product.id}</td>
                    <td><strong>${product.name}</strong></td>
                    <td>${product.type || ''}</td>
                    <td>${product.protection || ''}</td>
                    <td>${product.certification ? product.certification.join(', ') : ''}</td>
                    <td>${product.pdfUrl ? '<i class="fa fa-check" style="color: green;"></i>' : '<i class="fa fa-times" style="color: red;"></i>'}</td>
                    <td>${product.videoUrl ? '<i class="fa fa-check" style="color: green;"></i>' : '<i class="fa fa-times" style="color: red;"></i>'}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn-edit" onclick="editProduct('${product.id}')">
                                <i class="fa fa-edit"></i>
                            </button>
                            <button class="btn-delete" onclick="confirmDeleteProduct('${product.id}')">
                                <i class="fa fa-trash"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        // Actualizar estadísticas
        function updateStats() {
            document.getElementById('total-products').textContent = allProducts.length;

            const masks = allProducts.filter(p => p.category === 'mascarilla-desechable').length;
            document.getElementById('total-masks').textContent = masks;

            const certified = allProducts.filter(p => p.certification && p.certification.length > 0).length;
            document.getElementById('total-certified').textContent = certified;

            const withPdf = allProducts.filter(p => p.pdfUrl).length;
            document.getElementById('total-pdf').textContent = withPdf;
        }

        // Exportar productos
        function exportProducts() {
            const dataStr = JSON.stringify(allProducts, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);

            const exportFileDefaultName = 'ap-safety-products-' + new Date().toISOString().slice(0, 10) + '.json';

            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();

            showAlert('Productos exportados exitosamente', 'success');
        }

        // Importar productos
        function importProducts() {
            document.getElementById('import-file').click();
        }

        // Configurar importación
        function setupImportFile() {
            document.getElementById('import-file').addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = function(event) {
                    try {
                        const products = JSON.parse(event.target.result);
                        if (Array.isArray(products)) {
                            allProducts = products;
                            localStorage.setItem('apSafetyProductsDB', JSON.stringify(allProducts));
                            loadProductsList();
                            updateStats();
                            showAlert(`Se importaron ${products.length} productos exitosamente`, 'success');
                        } else {
                            showAlert('El archivo no tiene el formato correcto', 'danger');
                        }
                    } catch (error) {
                        showAlert('Error al leer el archivo: ' + error.message, 'danger');
                    }
                };
                reader.readAsText(file);
            });
        }

        // Confirmar reseteo
        function confirmResetProducts() {
            document.getElementById('modal-title').textContent = 'Confirmar Reseteo';
            document.getElementById('modal-message').textContent = '¿Estás seguro de que deseas resetear todos los productos? Esta acción cargará los productos desde el archivo JSON original.';

            const confirmBtn = document.getElementById('modal-confirm-btn');
            confirmBtn.onclick = function() {
                loadFromJSON();
                closeModal();
            };

            document.getElementById('confirm-modal').classList.add('active');
        }

        // Mostrar alerta
        function showAlert(message, type) {
            const alertsContainer = document.getElementById('alerts-container');
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type}`;
            alertDiv.innerHTML = `
                <i class="fa fa-${type === 'success' ? 'check' : 'exclamation'}-circle"></i> ${message}
            `;

            alertsContainer.appendChild(alertDiv);

            setTimeout(() => {
                alertDiv.remove();
            }, 5000);
        }
    </script>
</body>

</html>